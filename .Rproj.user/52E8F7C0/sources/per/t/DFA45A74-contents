---
title: "HousingData"
author: "Sean Tierney"
date: "November 27, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("tidyverse")
```

## Property Database FY 16-19

``` {r readDatabaseFile}
rawPropertyData <- read_delim('Cambridge_Property_Database_FY16-FY19.csv', delim = ',')
```

``` {r propDBSummary}
summary(rawPropertyData)
```

``` {r convertDtypes}
factorCols <- c(
  "PID",
  "StateClassCode",
  "PropertyClass",
  "Zoning",
  "TaxDistrict",
  "ResidentialExemption",
  "Owner_State",
  "Exterior_Style",
  "Exterior_occupancy",
  "Exterior_WallType",
  "Exterior_RoofType",
  "Exterior_RoofMaterial",
  "Interior_Flooring",
  "Interior_Layout",
  "Interior_LaundryInUnit",
  "Systems_HeatType",
  "Systems_HeatFuel",
  "Systems_CentralAir",
  "Systems_Plumbing",
  "Condition_InteriorCondition",
  "Condition_OverallCondition",
  "Condition_OverallGrade"
)

propertyData <- rawPropertyData %>% mutate_at(factorCols, as.factor)
```

``` {r plotAssessedValues}
ggplot(propertyData, aes(x = AssessedValue)) + geom_histogram(bins = 50) + scale_x_log10()
```

``` {r plotYearOfAssessment}
ggplot(propertyData, aes(x = YearOfAssessment)) + geom_histogram()
propertyData %>% filter(YearOfAssessment > 2019 | YearOfAssessment <= 1900) %>% ggplot(aes(x = YearOfAssessment)) + geom_histogram()
propertyData %>% filter(YearOfAssessment > 1990 & YearOfAssessment <= 2019) %>% ggplot(aes(x = YearOfAssessment)) + geom_histogram()
```

``` {r numberOfAssessments}
propertyData %>% count(PID) %>% arrange(desc(n)) %>% head(n = 15) %>% ggplot(aes(x = reorder(PID, n), y = n)) + geom_bar(stat = "identity") + xlab("Property ID") + ylab("Number of Assessments")
```


``` {r highAssessmentPropertyDetail}
propertyData %>% filter(PID == 11716)
propertyData %>% filter(PID == 21897)
propertyData %>% filter(PID == 12630)
```

Found Harvard and MIT!

``` {r whichPropertyClasses}
propertyData %>% count(PropertyClass) %>% arrange(desc(n))
propertyData %>% count(PropertyClass) %>% arrange(desc(n)) %>% head(n = 10) %>% ggplot(aes(x = reorder(PropertyClass, n), y = n)) + geom_bar(stat = "identity") + xlab("Property Class") + ylab("Number of Assessments")
```

``` {r singleResUnit}
singleResUnitData <- propertyData %>% filter(PropertyClass == "CONDOMINIUM" | PropertyClass == "SNGL-FAM-RES" | PropertyClass == "CNDO LUX")
singleResUnitData %>% group_by(PID) %>% summarize_if(is.numeric, max) %>% 
  filter(AssessedValue > 0) %>% filter(Interior_Bedrooms <= 3) %>%
  ggplot(aes(x = AssessedValue)) + geom_histogram(bins = 50) + scale_x_log10() + facet_grid(Interior_Bedrooms ~ .)
```
